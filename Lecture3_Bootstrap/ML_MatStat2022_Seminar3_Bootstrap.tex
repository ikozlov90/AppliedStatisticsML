\documentclass[9pt]{beamer}




\usepackage{beamerthemesplit}
\usetheme{Boadilla}
\usecolortheme{orchid}





 % \usepackage[cp866]{inputenc}                %%% Є®¤Ёа®ўЄ  DOS
  \usepackage[cp1251]{inputenc}
%  \usepackage[T2A]{fontenc}                %%% ???
%\usepackage[english,russian]{babel}
%\usepackage[russian]{babel}
 \usepackage[OT1]{fontenc}
%\usepackage[english]{babel}
\usepackage[russian]{babel}

\usepackage{amssymb,latexsym, amsmath, mathdots}

\usepackage{amscd}
\usepackage{multirow}
\usepackage{comment}

\usepackage{epstopdf}



%\usepackage[table]{xcolor} %colored cells

%\usepackage{tikz}
%\usetikzlibrary{tikzmark} %arrows in tables


\usepackage{mnsymbol} % udots in matrices

\usepackage{subcaption} % subfigures

 \usepackage{pgfpages}
%\setbeameroption{show notes}
%\setbeameroption{show notes on second screen=bottom}
%% \setbeameroption{show notes on second screen}

%\setbeamercolor{alerted text}{fg=red!80!black}


% \setbeamercolor{alerted text}{fg=blue!50!green}
% \setbeamercolor{fortheorem}{bg=blue!15!white}
% \setbeamercolor{EMPF}{bg=blue!25!white}
% \setbeamercolor{EMPF2}{bg=blue!35!white}

%\setbeamersize{text margin left=5.mm, text margin right=5.mm}


%---------------------------------------------------------------------------------------------------------------------------

%\def\emphbox#1#2#3{\begin{beamercolorbox}[wd=#2, ht=#1, center, colsep=1.mm]{EMPF} #3 \end{beamercolorbox}}

%---------------------------------------------------------------------------------------------------------------------------


%\advance\leftskip-5.mm



%***************************************************************************************************************************

\theoremstyle{theorem}
\newtheorem{mytheorem}[theorem]{Теорема}
\newtheorem{mylemma}[theorem]{Лемма}
\newtheorem{mycorollary}[theorem]{Следствие}

\newtheorem{proposition}[theorem]{Предложение}
\newtheorem{assertion}[theorem]{Утверждение}
\newtheorem{remark}[theorem]{Замечание}
\newtheorem{assumption}[theorem]{Предположение}

\newtheorem{convention}[theorem]{Договорённость}
\newtheorem{question}[theorem]{Вопрос}
%\newtheorem{mydefinition}{mydefinition}

\theoremstyle{definition}
\newtheorem{mydefinition}[theorem]{Определение}
\newtheorem{myexample}[theorem]{Пример}



%***************************************************************************************************************************

\chardef\No=194
\newcommand{\bd}{{\rm bd}}
\newcommand{\cl}{{\rm cl}}
\newcommand{\ind}{{\rm ind}}
\newcommand{\id}{{\rm id}}
\newcommand{\inj}{{\sl in}}
\newcommand{\pr}{{\rm pr}}
\newcommand{\st}{{\rm St}}


\DeclareMathOperator{\sgrad}{sgrad}

\DeclareMathOperator{\cnt}{const}

\DeclareMathOperator{\Aut}{Aut}


\DeclareMathOperator{\sgn}{sgn}

\DeclareMathOperator{\Int}{Int}


\DeclareMathOperator{\tr}{tr}

\DeclareMathOperator{\Mat}{Mat}







%****************************************************************************
\newcommand{\Ker}{\mathrm{Ker}\,\,}
\newcommand{\Ann}{\mathrm{Ann}\,\,}

\newcommand{\Imm}{\mathrm{Im}\,\,}

\newcommand{\rk}{\mathrm{rk}\,\,}

\newcommand{\const}{\mathrm{const}}



\DeclareMathOperator{\Pen}{\mathcal{P}}


\DeclareMathOperator{\Core}{K}


\DeclareMathOperator{\BLG}{\operatorname{BLG}}

\DeclareMathOperator{\AutBP}{\operatorname{Aut}(V, \mathcal{P})}


\def\minus{\hbox{-}}   %Sign of minus in big matrices

\usepackage{multirow}  %Columns spanning multiple rows

\usepackage[normalem]{ulem} %underline that can break lines

%\usepackage[normalem]{ulem}

%****************************************************************************



\title% [] (optional, only for long titles)
{Прикладная статистика в машинном обучении \\ Семинар 3 \\ Бутстреп}
%\subtitle{}
\author [И. \,К.~Козлов] %(optional, for multiple authors)
{И. \,К.~Козлов \\ {\footnotesize(\textit{Мехмат МГУ})}}


\date % [](optional)
{2022}
%\subject{Mathematics}








\usepackage{hyperref}
%\hypersetup{unicode=true}
\hypersetup{
  colorlinks=true,
  linkcolor=green!70!black, %blue!50!red,
  urlcolor=green!70!black,
  unicode=true
}



\begin{document}

%\includeonlyframes{}
\frame{\titlepage}



\section{Интегралы}



\begin{frame}[plain]\frametitle{Интегралы} \tableofcontents[currentsection]\end{frame}



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод Монте-Карло}
%----------------------------------------------------------




\begin{center}

На лекции мы обсудили {\color{blue} интегрирование методом Монте-Карло}. 

\vspace{5mm}

\textit{Оценка интеграла $\int_0^1 f(x) dx$ --- берём $f(x_i)$ в случайных точках и усредняем.}

\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.65\textwidth]{pic/MCIdea}}
%\caption{} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Интегрирование по Лебегу}
%----------------------------------------------------------

\textbf{Q:} Помните ли Вы, чем отличается {\color{blue} интеграл по Жордану} от {\color{red} интеграла по Лебегу}?


\vspace{5mm}

\pause

\begin{figure}[h!]
\center{\includegraphics[width=0.95\textwidth]{pic/Integrals}}
%\caption{} \label{Fig:}
\end{figure}
 
 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Интегрирование по Лебегу}
%----------------------------------------------------------


\textbf{Супер-наглябный пример}) \textit{Как считать деньги?}

\vspace{5mm}

\begin{itemize}

\item По Жордану --- суммируем подряд.

\vspace{5mm}

\item По Лебегу --- разбить по номиналу, просуммировать в кучках, потом сложить.

\end{itemize}

 
 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Интегрирование по Лебегу}
%----------------------------------------------------------


\begin{figure}[h!]
\center{\includegraphics[width=0.95\textwidth]{pic/Integrals2}}
%\caption{} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Интеграл Лебега}
%----------------------------------------------------------

Строгое определение {\color{blue} интеграла Лебега} см. 

\vspace{5mm}

\begin{thebibliography}{10} 
     \beamertemplatebookbibitems
  \bibitem{Lagutin}  А.\,Н.~Колмогоров, С.\,В.~Фомин
    \newblock {\em Элементы теории функций и функционального анализа}.      
  \end{thebibliography}

\vspace{5mm}

или любую другую хорошую книжку по теории функций/теории вероятностей.

 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


\section{Метод складного ножа}



\begin{frame}[plain]\frametitle{} \tableofcontents[currentsection]\end{frame}


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Литература}
%----------------------------------------------------------

Подробнее про метод складного ножа см.

\vspace{5mm}

\begin{thebibliography}{10}

    
  \beamertemplatebookbibitems
  \bibitem{Wasserman} Wasserman L. 
  
  \newblock{\em All of Nonparametric Statistics}.
    

\end{thebibliography}
  
  
  
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------
 
 \begin{itemize}
 
 \item Пусть $T_n = T(X_1, \dots, X_n)$ --- статистика.
 
 \vspace{5mm}
 
 \item $T_{(-i)}$ --- статистика для всех элементов \textit{кроме $i$-того}: \[ T_{(-i)} = T_{n-1}\left(X_1, \dots, X_{i-1}, X_{i+1}, \dots, X_n\right).\]

 \vspace{5mm}
 
 \item Обозначим \[ \bar{T}_n = \frac{1}{n} \sum_{i=1}^n  T_{(-i)}.\]
  
 \end{itemize}
 
 \vspace{5mm}
 
Идея {\color{blue} метода складного ножа} --- оценить смещение и дисперсию через оценки $T_{(-i)}$.
 
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------

\textbf{Задача 1}. {\color{blue} Оценка смещения методом складного ножа}. 
 
 \vspace{5mm}
 
 \begin{itemize}
 
 \item Пусть оценка для всех элементов: \[ T_n = \theta + \frac{a}{n} + \frac{b}{n^2} + O \left( \frac{1}{n^3}\right).\]

 \vspace{2mm}
 
 \item \textbf{Q:} Какая оценка на $\bar{T}_n = \sum_{i=1}^n  T_{(-i)}$?
 
 
 \end{itemize}
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------

 \begin{itemize}
 
 \item Пусть \[ T_n = \theta + \frac{a}{n} + \frac{b}{n^2} + O \left( \frac{1}{n^3}\right).\]

 \vspace{2mm}
 
 \item Тогда \[T_{(-i)} = \theta + \frac{a}{n-1} + \frac{b}{(n-1)^2} + O \left( \frac{1}{n^3}\right).\]
 

 \vspace{2mm}
 
 \pause
 
 \item Поэтому \[ \bar{T}_n = \sum_{i=1}^n  T_{(-i)} =  \theta + \frac{a}{n-1} + \frac{b}{(n-1)^2} + O \left( \frac{1}{n^3}\right).\]
 
 \end{itemize}

\vspace{5mm} 

\textbf{Q:} Как выразить $\displaystyle \operatorname{bias}(T_n) = \frac{a}{n} + O \left( \frac{1}{n^2}\right)$ через $ T_n$ и $\bar{T}_n$?


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------



 
 
{\color{blue} Оценка смещения} \[ b_{jack} = (n-1) (\bar{T}_n - T_n)\] 
 
 \vspace{2mm}
 
\textbf{Доказательство}. Напомним, что \[ T_n = \theta + \frac{a}{n} + \frac{b}{n^2} + O \left( \frac{1}{n^3}\right).\]
\[ \bar{T}_n = \sum_{i=1}^n  T_{(-i)} =  \theta + \frac{a}{n-1} + \frac{b}{(n-1)^2} + O \left( \frac{1}{n^3}\right).\]
 
 \vspace{2mm}
 
 Получаем требуемую оценку смещения до 2го порядка малости:  \[ b_{jack} = (n-1) (\bar{T}_n - T_n) = \frac{a}{n} + O \left( \frac{1}{n^2}\right)\]
 
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------

{\color{blue} Оценка дисперсии методом складного ножа}. 

\[ v_{jack} = \frac{n-1}{n} \sum_{i=1}^n \left( T_{(-i) } - \bar{T}_n \right)^2, \] 
 
 оценка стандартного отклонения $\hat{\operatorname{se}}_{jack} = \sqrt{v_{jack} }$. 
 
 
 \vspace{5mm}
 
 Это состоятельная оценка на $\mathbb{V}(T_n)$ (при должных условиях) \[\frac{v_{jack} }{\mathbb{V}(T_n)} \ \xrightarrow {\mathbb{P}} \ 1. \]
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------

\textbf{Задача 2}. Найти оценки смещения и дисперсии методом складного ножа для $T_n = \bar{X}_n$.

 
 \vspace{5mm}
 
 
 \pause
 
 \textbf{A1:}   Оценка смещения \[ b_{jack} = (n-1) (\bar{T}_n - T_n) = 0.\] 
 
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------


\textbf{A2:} Оценка дисперсии методом складного ножа: 

\[ v_{jack} = \frac{n-1}{n} \sum_{i=1}^n \left( T_{(-i) } - \bar{T}_n \right)^2 =  \] 
\[ = \frac{n-1}{n} \sum_{i=1}^n \left( \frac{1}{n-1}\left( n \cdot \bar{X}_n - X_{i}\right) - \bar{X}_n \right)^2 =  \]
\[ = \frac{1}{n} \frac{1}{n-1}\sum_{i=1}^n \left( \frac{1}{n-1} \left( \cdot \bar{X}_n - X_{i}\right)\right)^2 = \frac{S^2_n}{n}. \]
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод складного ножа}
%----------------------------------------------------------

\begin{mytheorem}[Efron, 1982] 

\begin{itemize}

\item Оценки дисперсии методом складного ножа для квантилей $T(F) = F^{-1}(p)$ несостоятельны. 

\vspace{5mm}

\item Для медианы ($p = \frac{1}{2}$)  \[\frac{v_{jack} }{\sigma^2_n} \ \xrightarrow {d} \left(\frac{\chi^2_2}{2} \right)^2,\] где $\sigma^2_n$ --- асимптотическая оценка дисперсии медианы, а $\chi^2_2$ --- распределение хи-квадрат. 

\end{itemize}

\end{mytheorem}
 
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Jack of all trades}
%----------------------------------------------------------



 \begin{center}
\Large Jackknife --- может применяться везде, полезен почти никогда. 
 \end{center}

\begin{figure}[h!]
\center{\includegraphics[height=0.5\textheight]{pic/JackTrades}}
%\caption{} \label{Fig:}
\end{figure}
 
 
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



\section{Медиана}



\begin{frame}[plain]\frametitle{Медиана} \tableofcontents[currentsection]\end{frame}

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Медиана и квантили}
%----------------------------------------------------------


\begin{itemize}

\item \Large {\color{blue} Мода} --- наиболее частое значение.

\vspace{5mm}

\item {\color{blue} Медиана} MED = серединное значение ($\mathbb{P}(X < MED) = \frac{1}{2}$).

\vspace{5mm}

\item {\color{blue} Среднее значение = матожидание} $\mathbb{E} X$. 

\end{itemize}

\begin{figure}[h!]
\center{\includegraphics[height=0.5\textheight]{pic/Median}}
%\caption{} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------





%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Медиана и квантили}
%----------------------------------------------------------

Предельное распределение для медианы известно:

\vspace{3mm}

\begin{block}{Теорема} 
Пусть элементы выборки имеют плотность $p(x)$, причём $p(x_{\frac{1}{2}}) >0$. Тогда \[ \sqrt{n} \left( MED - x_{\frac{1}{2}}\right)  \ \xrightarrow {\mathbb{d}} \  \xi \sim \mathcal{N} \left(0, \frac{1}{4 p^2(x_{\frac{1}{2}})} \right).\]
\end{block}


\vspace{5mm}

\pause

Есть аналогичная теорема для квантилей $x_{\alpha}$. Там дисперсия  $\displaystyle \frac{\alpha (1-\alpha)}{ p^2(x_{\alpha})}$.


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Медиана и квантили}
%----------------------------------------------------------

Подробнее про распределение для квантилей с док-вами --- см. Главу 7

\vspace{3mm}

\begin{thebibliography}{10} 
     \beamertemplatebookbibitems
  \bibitem{Lagutin}  М.\,Б.~Лагутин, 
    \newblock {\em Наглядная математическая статистика}.      
  \end{thebibliography}
 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Медиана и матожидание}
%----------------------------------------------------------

\textbf{Q:} Какое преимущество имеет медиана перед средним значением?

\vspace{5mm}


\pause

\textbf{A:} Не так сильно подвержены выбросам. 

\begin{figure}[h!]
\center{\includegraphics[width=0.65\textwidth]{pic/Outlier}}
%\caption{} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Медиана и матожидание}
%----------------------------------------------------------

{\color{blue} Выбросы} (Outliers) --- очень важная проблема в ML.

\vspace{5mm}

И априори не понятно --- это особые случаи/праздники и т.д. или неверные данные.

\begin{figure}[h!]
\center{\includegraphics[width=0.65\textwidth]{pic/Out}}
%\caption{} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Робастность}
%----------------------------------------------------------

Робастность (устойчивость к выбросам) обсуждается в Главу 8

\vspace{3mm}

\begin{thebibliography}{10} 
     \beamertemplatebookbibitems
  \bibitem{Lagutin}  М.\,Б.~Лагутин, 
    \newblock {\em Наглядная математическая статистика}.      
  \end{thebibliography}
 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Робастность}
%----------------------------------------------------------

\textbf{Q:} Бутстреп и выбросы --- будут проблемы?

\vspace{5mm}

\pause 

\textbf{A:}  Да, будут проблемы --- выбросы при сэмплировании окажут ещё большее влияние. 

\vspace{5mm}

\begin{figure}[h!]
\center{\includegraphics[width=0.5\textwidth]{pic/Swan}}
%\caption{} \label{Fig:}
\end{figure}

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



\section{LOO-CV}



\begin{frame}[plain]\frametitle{LOO-CV} \tableofcontents[currentsection]\end{frame}


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Leave one out cross-validation}
%----------------------------------------------------------


\textbf{Q:} Какую ML-технику напоминает Jackknife?

\vspace{5mm}


\pause

\textbf{A:} Скользящий контроль по отдельным объектам = {\color{blue} Leave one out cross-validation}.
 
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Leave one out cross-validation}
%----------------------------------------------------------

\begin{center}
\Large {\color{blue} Leave one out cross-validation}:
\end{center}

\begin{figure}[h!]
\center{\includegraphics[height=0.5\textheight]{pic/LOO}}
%\caption{} \label{Fig:}
\end{figure}
 
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Временные ряды}
%----------------------------------------------------------


\begin{center}

{\color{blue} Временные ряды}. 

\vspace{5mm}

\textbf{Q:} Хорошо ли применять для них кросс-валидацию?

\end{center}


\begin{figure}[h!]
\center{\includegraphics[width=0.5\textwidth]{pic/Time}}
%\caption{} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Временные ряды. Кросс-валидация}
%----------------------------------------------------------

\begin{center}
\Large Нельзя допускать {\color{blue} утечки данных} ({\color{red} Data Leakage})!

\vspace{5mm}

\textbf{Нельзя предсказывать прошлое по будущему!}

\vspace{5mm}


\pause

Возможная схема кросс-валидации:

\end{center}

\begin{figure}[h!]
\center{\includegraphics[height=0.5\textheight]{pic/Test2}}
%\caption{} \label{Fig:}
\end{figure}
 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Временные ряды. Кросс-валидация}
%----------------------------------------------------------

\begin{center}
\Large Другая схема кросс-валидации для временных рядов:

\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.5\textwidth]{pic/Test3}}
%\caption{} \label{Fig:}
\end{figure}
 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Проблемы бутстрепа}
%----------------------------------------------------------

\textbf{Q:} Когда бутстреп плохо применять?

\vspace{5mm}

\pause

\textbf{A:} Могут быть различные проблемы. Как минимум:

\vspace{5mm}

\begin{enumerate}

\item Маленькая выборка.

\vspace{5mm}

\item Есть выбросы.

\vspace{5mm}

\item Теряется структура данных (временные ряды, симметрии, ограничения и т.д.).

\end{enumerate}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Проблемы бутстрепа}
%----------------------------------------------------------

\begin{center}
Подробнее про проблемы бутстрепа:

\vspace{5mm}

\url{https://notstatschat.tumblr.com/post/156650638586/when-the-bootstrap-doesnt-work} 

\end{center}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


\section{Бутстреп на практике}



\begin{frame}[plain]\frametitle{Бутстреп на практике} \tableofcontents[currentsection]\end{frame}

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Временные ряды. Кросс-валидация}
%----------------------------------------------------------

\begin{center}

Пример применения бутстрепа.

\vspace{5mm}

{\color{blue} Scipy} --- главный пакет для Python по статистике:

\vspace{5mm}

\url{https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.bootstrap.html}

\end{center}
 

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

\end{document}