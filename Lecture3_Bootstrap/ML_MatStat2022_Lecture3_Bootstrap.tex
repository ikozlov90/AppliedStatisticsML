\documentclass[9pt]{beamer}




\usepackage{beamerthemesplit}
\usetheme{Boadilla}
\usecolortheme{orchid}





 % \usepackage[cp866]{inputenc}                %%% Є®¤Ёа®ўЄ  DOS
  \usepackage[cp1251]{inputenc}
%  \usepackage[T2A]{fontenc}                %%% ???
%\usepackage[english,russian]{babel}
%\usepackage[russian]{babel}
 \usepackage[OT1]{fontenc}
%\usepackage[english]{babel}
\usepackage[russian]{babel}

\usepackage{amssymb,latexsym, amsmath, mathdots}

\usepackage{amscd}
\usepackage{multirow}
\usepackage{comment}

\usepackage{epstopdf}



%\usepackage[table]{xcolor} %colored cells

%\usepackage{tikz}
%\usetikzlibrary{tikzmark} %arrows in tables


\usepackage{mnsymbol} % udots in matrices

\usepackage{subcaption} % subfigures

 \usepackage{pgfpages}
%\setbeameroption{show notes}
%\setbeameroption{show notes on second screen=bottom}
%% \setbeameroption{show notes on second screen}

%\setbeamercolor{alerted text}{fg=red!80!black}


% \setbeamercolor{alerted text}{fg=blue!50!green}
% \setbeamercolor{fortheorem}{bg=blue!15!white}
% \setbeamercolor{EMPF}{bg=blue!25!white}
% \setbeamercolor{EMPF2}{bg=blue!35!white}

%\setbeamersize{text margin left=5.mm, text margin right=5.mm}


%---------------------------------------------------------------------------------------------------------------------------

%\def\emphbox#1#2#3{\begin{beamercolorbox}[wd=#2, ht=#1, center, colsep=1.mm]{EMPF} #3 \end{beamercolorbox}}

%---------------------------------------------------------------------------------------------------------------------------


%\advance\leftskip-5.mm



%***************************************************************************************************************************

\theoremstyle{theorem}
\newtheorem{mytheorem}[theorem]{Теорема}
\newtheorem{mylemma}[theorem]{Лемма}
\newtheorem{mycorollary}[theorem]{Следствие}

\newtheorem{proposition}[theorem]{Предложение}
\newtheorem{assertion}[theorem]{Утверждение}
\newtheorem{remark}[theorem]{Замечание}
\newtheorem{assumption}[theorem]{Предположение}

\newtheorem{convention}[theorem]{Договорённость}
\newtheorem{question}[theorem]{Вопрос}
%\newtheorem{mydefinition}{mydefinition}

\theoremstyle{definition}
\newtheorem{mydefinition}[theorem]{Определение}
\newtheorem{myexample}[theorem]{Пример}



%***************************************************************************************************************************

\chardef\No=194
\newcommand{\bd}{{\rm bd}}
\newcommand{\cl}{{\rm cl}}
\newcommand{\ind}{{\rm ind}}
\newcommand{\id}{{\rm id}}
\newcommand{\inj}{{\sl in}}
\newcommand{\pr}{{\rm pr}}
\newcommand{\st}{{\rm St}}


\DeclareMathOperator{\sgrad}{sgrad}

\DeclareMathOperator{\cnt}{const}

\DeclareMathOperator{\Aut}{Aut}


\DeclareMathOperator{\sgn}{sgn}

\DeclareMathOperator{\Int}{Int}


\DeclareMathOperator{\tr}{tr}

\DeclareMathOperator{\Mat}{Mat}







%****************************************************************************
\newcommand{\Ker}{\mathrm{Ker}\,\,}
\newcommand{\Ann}{\mathrm{Ann}\,\,}

\newcommand{\Imm}{\mathrm{Im}\,\,}

\newcommand{\rk}{\mathrm{rk}\,\,}

\newcommand{\const}{\mathrm{const}}



\DeclareMathOperator{\Pen}{\mathcal{P}}


\DeclareMathOperator{\Core}{K}


\DeclareMathOperator{\BLG}{\operatorname{BLG}}

\DeclareMathOperator{\AutBP}{\operatorname{Aut}(V, \mathcal{P})}


\def\minus{\hbox{-}}   %Sign of minus in big matrices

\usepackage{multirow}  %Columns spanning multiple rows

\usepackage[normalem]{ulem} %underline that can break lines

\usepackage{mathtools} %overbrace

%\usepackage[normalem]{ulem}

\usepackage{wasysym} %smile

%****************************************************************************



\title% [] (optional, only for long titles)
{Прикладная статистика в машинном обучении \\ Лекция 3 \\ Бутстреп}
%\subtitle{}
\author [И. \,К.~Козлов] %(optional, for multiple authors)
{И. \,К.~Козлов \\ {\footnotesize(\textit{Мехмат МГУ})}}


\date % [](optional)
{2022}
%\subject{Mathematics}






\usepackage{hyperref}
%\hypersetup{unicode=true}
\hypersetup{
  colorlinks=true,
  linkcolor=green!70!black, %blue!50!red,
  urlcolor=green!70!black,
  unicode=true
}



\begin{document}

%\includeonlyframes{}
\frame{\titlepage}




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Вопрос дня}
%----------------------------------------------------------


\begin{center}



Нужны данные о 100 котятах. У нас есть 6 котят.

\vspace{5mm}

\textit{Что делать?} 

\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.55\textwidth]{pic/Kitten}}
\caption{Каждый котёнок --- индивидуальность!} \label{Fig:}
\end{figure}




%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Не CatBoost, а Bootstrap!}
%----------------------------------------------------------

\textbf{Q:} Как получить больше информации, если мы не можем больше сэмплировать?

\vspace{5mm}
 
 \textbf{A:} Изучать имеющиеся объекты по несколько раз!
 
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



\section{Доверительные интервалы}



\begin{frame}[plain]\frametitle{Доверительные интервалы} \tableofcontents[currentsection]\end{frame}

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Доверительный интервал}
%----------------------------------------------------------

{\color{blue} Доверительный интервал} с доверительной вероятностью $1-\alpha$ для параметра $\theta$ --- это интервал \[ C_n = (a, b), \qquad a = a(X_1, \dots, X_n), \quad b = b(X_1, \dots, X_n),\] для которого \begin{equation}  \label{Eq:Dov} P_{\theta} (\theta \in C_n) \geq 1 - \alpha, \qquad \text{ для всех } \theta \in \Theta.\end{equation}


\vspace{5mm}

\textbf{Q:} Что такое $95\%$ доверительный интервал? Что означает ``вероятность $95\%$''?



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Фриквентистский подход}
%----------------------------------------------------------


\textbf{Q2:} $C_n$ и $\theta$ --- что здесь случайные величины?

\vspace{5mm}

\pause

\begin{itemize}

\item $\theta$ --- (неизвестный) фиксированный параметр.

\vspace{5mm}

\item $C_n$ --- случайная величина. 

\end{itemize}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Фриквентистский подход}
%----------------------------------------------------------



\textbf{Фриквентистская (частотная) интерпретация вероятности}:

\vspace{5mm}

\begin{itemize}

\item Проводим (бесконечную) серию экспериментов. 

\vspace{5mm}

{\color{blue}  Вероятность события} --- предел частоты этого события в экспериментах: \[ {\displaystyle P(A)=\lim _{N\rightarrow \infty }{\frac {n}{N}}}.\]  \end{itemize}



\pause

\vspace{5mm}

\textit{Пример.} Подбрасываем монетку. \[ \text{Вероятность выпадения орла } p = \lim _{N\rightarrow \infty } \frac{\text{число орлов}}{\text{число бросков}}.\]



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Фриквентистский подход}
%----------------------------------------------------------

\textbf{Интерпретация доверительного интервала-1}.

\vspace{5mm}

Проводим один и тот же эксперимент. {\color{red} $\theta$ --- не меняется}, фиксированный параметр.


\vspace{5mm}


В $95\%$ случаев (в пределе) $\theta$ попадаем в построенный интервал $C_n$.

\vspace{5mm}

\textbf{Q:} Слабое место этой интерпретации? 

\vspace{5mm}


\textbf{A:} Нужно проводить один и тот же эксперимент.


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Фриквентистский подход}
%----------------------------------------------------------


\textbf{Интерпретация доверительного интервала-2}.

\vspace{5mm}

Проводим серию экспериментов. 

\vspace{5mm}

\begin{enumerate}

\item В 1ый день строим $95\%$ доверительный интервал для параметра $\theta_1$.

\vspace{5mm}

\item Во 2ой день строим $95\%$ доверительный интервал для параметра $\theta_2$.
\vspace{5mm}

\item  И так далее...
\end{enumerate} 

\vspace{5mm}

В $95\%$ случаев (в пределе) $\theta_i$ попадаем в построенный интервал.



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Социология}
%----------------------------------------------------------

{\Large
\textit{Пример}. Покупаем каждый день газету. Там рейтинг кандидатов $\pm$ пара пунктов.

\vspace{5mm}

Обычно это $95\%$ интервал.
}

\vspace{5mm}

\begin{figure}[h!]
\center{\includegraphics[width=0.55\textwidth]{pic/Trump1}}
%\caption{Каждый котёнок --- индивидуальность!} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Чёрный лебедь}
%----------------------------------------------------------

\begin{center}
{\Large Только в $95\%$ случаев(!) }
\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.55\textwidth]{pic/Trump2}}
\caption{\Large Жизнь не идеальна\footnote{Российскую социологию даже обсуждать не будем}} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Асимптотический доверительный интервал}
%----------------------------------------------------------

\textit{Как строить доверительный интервал?}

\vspace{5mm}


Точно построить сложно, пытаемся сделать это асимптотически:

\vspace{5mm}

\begin{itemize}

%\item {\color{blue} Равномерный асимптотический} доверительный интервал \[ \liminf_{n \to \infty} \quad \inf_{\theta} \mathbb{P}_{\theta} (\theta \in C_{n}) \geq 1 - \alpha. \] 

%\vspace{5mm}


\item {\color{blue} Поточечный асимптотический} доверительный интервал \[ \liminf_{n \to \infty} \quad \mathbb{P}_{\theta} (\theta \in C_{n}) \geq 1 - \alpha,  \qquad \text{ для всех } \theta \in \Theta.\]

\end{itemize}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



\section{Асимптотическая нормальность и доверительные интервалы}



\begin{frame}[plain]\frametitle{Асимптотическая нормальность и доверительные интервалы} \tableofcontents[currentsection]\end{frame}


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Асимптотический доверительный интервал}
%----------------------------------------------------------



В начале рассмотрим случай, когда оценка асимптотически нормальна: \[ \frac{\hat{\theta} - \theta}{{\sigma}} \to \mathcal{N} (0,1). \]

\vspace{3mm}

Для краткости будем писать \[ \hat{\theta} \approx \mathcal{N} (\theta, \sigma^2).\]



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Типичный доверительный интервал}
%----------------------------------------------------------


\textbf{Q:} Как построить $(1-\alpha)$ доверительный интервал вокруг моды нормального распределения?

\vspace{5mm}


\textbf{A:}  Неформально, ``отрубить $\frac{\alpha}{2}$ хвосты'' с обеих сторон. 

\vspace{5mm}

$z_{\alpha}$ --- стандартное обозначение квантиля $\Phi^{-1}(\alpha)$. 



\begin{figure}[h!]
\center{\includegraphics[width=0.65\textwidth]{pic/NormAlpha}}
%\caption{Неравенства страшные} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Типичный доверительный интервал}
%----------------------------------------------------------

\begin{block}{}
Часто оценка параметров асимптотически нормальна: \[ \hat{\theta}_n \approx \mathcal{N} (\theta, \hat{\operatorname{se}}^2).\] Асимптотический доверительный интервал \[ \left(\hat{\theta}_n - z_{\alpha/2} \hat{\operatorname{se}}, \quad  \hat{\theta}_n + z_{\alpha/2} \hat{\operatorname{se}}\right).\]
\end{block}

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Правило 3 сигм}
%----------------------------------------------------------

\begin{center}
\large $z_{0,025} =1.96 \approx 2$, поэтому $95\%$  данных лежит в интервале $\hat{\theta} \pm 2 \,\, \hat{\operatorname{se}}$.

\vspace{5mm}

 {\color{blue} ``Правило 3 сигм''}: а $99\%$ данных --- в интервале $\hat{\theta} \pm 3 \,\, \hat{\operatorname{se}}$. %3 стандартных отклонения от среднего значения.
\end{center}

\vspace{2mm}
 
%{\color{red} Отметим, что $z_{0,025} =1.96 \approx 2$, поэтому часто за $95\%$  доверительный интервал берут \[\hat{\theta} \pm 2 \,\, \hat{\operatorname{se}}. \]}


\begin{figure}[h!]
\center{\includegraphics[width=0.9\textwidth]{pic/3SigmaRule}}
%\caption{Неравенства страшные} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{ЦПТ}
%----------------------------------------------------------



\begin{block}{Центральная предельная теорема.} Если ${\mathbb{V} X_{i} =\sigma ^{2}<\infty }$, то \[{\displaystyle {\sqrt {n}}\left({\bar {X}}_{n}-\mu \right)\ \xrightarrow {d} \ {\mathcal {N}}\left(0,\sigma ^{2}\right).}\] \end{block}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Дельта-метод}
%----------------------------------------------------------


\textbf{Дельта-метод}. Пусть $g$ дифференцируема в $\mu$ и  $g'(\mu) \not = 0$, тогда \[ {{\sqrt  {n}}[X_{n}- \mu ]\,{\xrightarrow  {D}}\,{\mathcal  {N}}(0,\sigma ^{2})} \qquad \Rightarrow \qquad {\displaystyle {{\sqrt {n}}[g(X_{n})-g(\mu)]\,{\xrightarrow {D}}\,{\mathcal {N}}(0,\sigma ^{2}\cdot [g'(\mu)]^{2})}} \]




%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Дельта-метод}
%----------------------------------------------------------

\begin{figure}[h!]
\center{\includegraphics[width=0.75\textwidth]{pic/DeltaMethod}}
\caption{\Large Образ ``нормальной шапочки'' --- ``нормальная шапочка''} \label{Fig:}
\end{figure}

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Дельта-метод}
%----------------------------------------------------------


Доказательство --- см. Лемму 1, Глава 7, $\S 3$,

\vspace{3mm}

\begin{thebibliography}{10} 
     \beamertemplatebookbibitems
  \bibitem{Lagutin}  М.\,Б.~Лагутин, 
    \newblock {\em Наглядная математическая статистика}.      
  \end{thebibliography}
  

\vspace{3mm}

По сути --- разлагаем в ряд Тейлора и применяем свойства сходимости. 


%\textbf{Доказательство}:

%\begin{itemize}

%\item Разложим $g(x)$ в точке $\mu$ в ряд Тейлора


%\item 

%\end{itemize}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Дельта-метод}
%----------------------------------------------------------


\textbf{Дельта-метод (многомерный случай)}.

\vspace{5mm} Пусть $g$ дифференцируема. 

\vspace{5mm} Обозначим через $\nabla_{\mu}$ градиент $g$ в точке $\mu$. 

\vspace{5mm} 

Если $\nabla_{\mu} \not = 0$, то \[ {{\sqrt  {n}}[X_{n}- \mu ]\,{\xrightarrow  {D}}\,{\mathcal  {N}}(0,\Sigma)} \qquad \Rightarrow \qquad {\displaystyle {{\sqrt {n}}[g(X_{n})-g(\mu)]\,{\xrightarrow {D}}\,{\mathcal {N}}(0,\nabla_{\mu}^T \Sigma \nabla_{\mu})}}. \] 


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


\section{Бутстреп}



\begin{frame}[plain]\frametitle{Бутстреп} \tableofcontents[currentsection]\end{frame}


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Бутстреп}
%----------------------------------------------------------


\begin{figure}[h!]
\center{\includegraphics[width=0.5\textwidth]{pic/BootStrap}}
\caption{Bootstrap} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------







%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Оценка дисперсии}
%----------------------------------------------------------

$T = g(X_1, \dots, X_n)$ --- статистика.

\vspace{5mm}

На практике мы часто хотим оценить разброс/дисперсию $\mathbb{V}_F(T)$.

\pause

\vspace{5mm}

\textbf{Есть проблемы:}

\vspace{5mm}

\begin{enumerate}


\item  Мы не знаем распределение на $T$.

\vspace{5mm}


\item Мы не знаем $F$ --- распределение на $X_i$. 


\end{enumerate}

%\vspace{5mm}

%\textbf{Q:} Что будем делать?



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Оценка распределения}
%----------------------------------------------------------


Более простой вопрос:

\vspace{5mm}

\textbf{Q:} Чем заменить распределение $F$?

\vspace{5mm}

\pause

\textbf{A:} Эмпирической функцией распределения $\hat{F}$.  


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Оценка матожидания функции}
%----------------------------------------------------------

Осталось понять --- как считать дисперсию $\mathbb{V}_{\hat{F}}(T)$?


\vspace{5mm}

Более общий \textbf{вопрос:}  как считать дисперсию \[ \mathbb{V}(Y) = \mathbb{E} \left(Y - \bar{Y}\right)^2?\]

\vspace{5mm}

\pause

Дисперсия --- матожидание от конкретной функции. 

\vspace{5mm}

Ещё более общий \textbf{вопрос:} как вычислить матожидание \[\mathbb{E}_{G} \left( h(Y) \right)  = \int_{-\infty}^{\infty} h(y) dG(y)?\] 


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



\subsection{Метод Монте-Карло}



\begin{frame}[plain]\frametitle{Метод Монте-Карло} \tableofcontents[currentsubsection]\end{frame}



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод Монте-Карло}
%----------------------------------------------------------


\begin{center}
\large Важная идея --- {\color{blue} метод Монте-Карло}.

\vspace{5mm}

Монте-Карло знаменито своими казино.
\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.65\textwidth]{pic/MonteCasino}}
\caption{\large Рулетка --- генератор случайных чисел} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод Монте-Карло}
%----------------------------------------------------------

\begin{center}
\textbf{Простая идея.} Как посчитать $\int_0^1 f(x) dx$?  

\vspace{5mm}
Интеграл = площадь под графиком = среднее значение $f(x)$ на отрезке [0,1].

\vspace{5mm}

\textit{Оценка интеграла --- берём $f(x_i)$ в случайных точках и усредняем.}

\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.65\textwidth]{pic/MCIdea}}
%\caption{} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод Монте-Карло}
%----------------------------------------------------------


Как вычислить матожидание \[\mathbb{E}_{G} \left( h(Y) \right)  = \int_{-\infty}^{\infty} h(y) dG(y)?\] 

\vspace{2mm}

Пусть мы {\color{red} умеем сэмплировать} из распределения $G$. 


\vspace{5mm}

{\color{blue} Метод Монте-Карло}:

\vspace{5mm}

\begin{itemize}

\item Берём $Y_1, \dots, Y_B$ --- i.i.d. из распределения $G$. 

\vspace{5mm}


\item \textit{Оценка матожидания: берём значения в этих точках и усредняем.} 

\vspace{5mm}

По (У)ЗБЧ \[ \frac{1}{B} \sum_{j=1}^B h(Y_j) \ {\xrightarrow {a.s.}}\ \mathbb{E}(h(Y_1)) = \int h(y) d G(y). \]

\end{itemize}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Дисперсия. Монте-Карло}
%----------------------------------------------------------


В интересующем нас случае:

\vspace{5mm}

\begin{alertblock}{}
$ \mathbb{V}(Y)$ можно аппроксимировать выборочной дисперсией $ \frac{1}{B} \sum_{j=1}^B \left(Y_j - \bar{Y} \right)^2$.
\end{alertblock}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Метод Монте-Карло}
%----------------------------------------------------------


Сделаем пару замечаний о {\color{blue} методе Монте-Карло.} Подробнее --- см. Глава 3

\vspace{3mm}

\begin{thebibliography}{10} 
     \beamertemplatebookbibitems
  \bibitem{Lagutin}  М.\,Б.~Лагутин, 
    \newblock {\em Наглядная математическая статистика}.      
  \end{thebibliography}
  
 \vspace{5mm}
 
 \textbf{Q:} Плюсы и минусы метода Монте-Карло?
  

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Минусы MC}
%----------------------------------------------------------


{\color{red} Недостатки метода Монте-Карло:}

\vspace{5mm}

\begin{itemize}

\item Это вероятностный метод.

\vspace{5mm}

\item Сходимость порядка\footnote{Типичный порядок сходимости в статистике} $\frac{1}{\sqrt{n}}$.

\vspace{5mm}

\item Для оценки сходимости нужно считать дисперсию.

\vspace{5mm}

\item  Проклятия размерности.

\end{itemize}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Проклятие размерности}
%----------------------------------------------------------

\begin{center}
{\color{blue} Проклятие размерности}

\vspace{5mm}

\Large Пусть данные в кубе $[0,1]^D$. Какая доля данных попадёт в $[0, \frac{1}{2}]^D?$ 

\end{center} 

\vspace{-2mm}

\begin{figure}[h!]
\center{\includegraphics[width=0.55\textwidth]{pic/Curse}}
\caption{\Large Чем больше размерность, тем более разреженные данные.} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Плюсы MC}
%----------------------------------------------------------


\vspace{5mm}

{\color{blue} Достоинства метода Монте-Карло:}

\vspace{5mm}

\begin{itemize}

\item Применим и к многомерным интегралам.

\vspace{5mm}

\item Универсальная и далеко идущая идея.

\end{itemize}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



\subsection{Схема Бутстрепа}



\begin{frame}[plain]\frametitle{Схема Бутстрепа} \tableofcontents[currentsubsection]\end{frame}



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Идея бутстрепа}
%----------------------------------------------------------


\textbf{Идея бутстрепа}:

\vspace{5mm}

\begin{enumerate}

\item Оценить  $\mathbb{V}_F(T)$ при помощи $\mathbb{V}_{\hat{F}_n}(T)$.

\vspace{5mm}

\item Аппроксимируем $\mathbb{V}_{\hat{F}_n}(T)$, используя моделирование Монте-Карло.

\end{enumerate}


\vspace{5mm}

\textit{Замечание}. Если мы можем явно посчитать  $\mathbb{V}_{\hat{F}_n}(T)$, 2ой шаг проводить не надо.


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Собираем воедино}
%----------------------------------------------------------


\begin{center}
\Large Остаётся собрать всё воедино.
\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.9\textwidth]{pic/Combine}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Схема бутстрепа}
%----------------------------------------------------------

{\color{red} Оценка дисперсии с помощью бутстрепа}.

\vspace{5mm}

\begin{enumerate}


\item Сэмплируем $X_1^*, \dots, X_n^* \sim \hat{F}_n$.

\vspace{5mm}

\item Вычисляем $T^*_n = g(X_1^*, \dots, X_n^*)$. 

\vspace{5mm}

\item Повторяем шаги 1 и 2 $B$ раз, получаем $T^*_{n,1}, \dots, T^*_{n, B}$.

\vspace{5mm}

\item Оценка дисперсии \[ v_{boot} = \frac{1}{B} \sum_{b=1}^B \left( T^*_{n, b}  - \frac{1}{B} \sum_{j=1}^B T^*_{n, j} \right)^2.  	\]

\end{enumerate}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Выборки}
%----------------------------------------------------------

\textbf{Контрольный вопрос}. Что такое сэмплировать из $\hat{F}_n$?

\vspace{5mm}

\pause

\textbf{A:} Равновероятно взять одно из $X_1, \dots, X_n$. 

\vspace{5mm}

Бутстреп $\to$ выборка с возвращением.

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Аппроксимации}
%----------------------------------------------------------

Аппроксимации в бутстрепе:

\vspace{5mm}

\[ V_{F}(T_n) \overbrace{\approx}^{O(1/ \sqrt{n})} V_{\hat{F}_n}(T_n) \overbrace{\approx}^{O(1/ \sqrt{B}) } v_{boot}.\]



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Перерыв}
%----------------------------------------------------------


\begin{center}
\Huge Перерыв
\end{center}
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


\section{Доверительные интервалы}



\begin{frame}[plain]\frametitle{Доверительные интервалы} \tableofcontents[currentsection]\end{frame}

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Нормальный интервал}
%----------------------------------------------------------



Обсудим 3 способа построить \textit{доверительные интервалы} с помощью \textit{бутстрепа}.

\vspace{5mm}


Обозначим $\theta = T(F)$ --- то, что предсказываем. $\hat{\theta}_n = T(\hat{F}_n)$ --- наша оценка.


\vspace{5mm}


\begin{enumerate}

\item \textbf{Нормальный интервал}. \[ \hat{\theta}_n  \pm z_{\alpha/2} \hat{\operatorname{se}}_{\operatorname{boot}},\]

\end{enumerate}

\vspace{2mm}

где $\hat{\operatorname{se}}_{\operatorname{boot}} = \sqrt{v_{\operatorname{boot}}}$ --- оценка дисперсии при помощи бутстрепа. 

\vspace{5mm}

Не очень эффективная оценка, если данные не нормально распределены.

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Терпение и труд всё перетрут}
%----------------------------------------------------------


\begin{center} \Large В следующих 2 способах будет немного формул. \end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.5\textwidth]{pic/Patience}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Центральный интервал}
%----------------------------------------------------------


\begin{enumerate}

\setcounter{enumi}{1}

\item \textbf{Центральный интервал}. 

\vspace{5mm}

Положим $R_n = \hat{\theta}_n - \theta$;

\vspace{5mm}

 $H(r)$ --- распределение величины $R_n$, т.е. \[ H(r) = \mathbb{P}(R_n \leq r).\]

\end{enumerate}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Центральный интервал}
%----------------------------------------------------------


Покажем, что \textbf{точный $(1-\alpha)$ доверительный интервал} суть $C_n^* = (a, b)$, где \[ a = \hat{\theta}_n - H^{-1}\left(1 - \frac{\alpha}{2}\right), \qquad b = \hat{\theta}_n - H^{-1}\left(\frac{\alpha}{2}\right).\]

\textbf{Доказательство:}


\pause

\begin{figure}[h!]
\center{\includegraphics[width=0.8\textwidth]{pic/Proof1}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}





%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Центральный интервал}
%----------------------------------------------------------

\textbf{Q:} Мы не знаем распределение $H$. Что делать?

\vspace{5mm}

\pause

\textbf{A:} Правильно, используем {\color{blue} бутстреп }.

\vspace{5mm}

$\hat{\theta}^*_{n,1}, \dots \hat{\theta}^*_{n,B}$ --- повторная выборка $\hat{\theta}_n = T(\hat{F}_n)$  на основе бутстрепа.

\vspace{5mm}


Полагаем $\hat{R}^*_{n, b} = \hat{\theta}^*_{n,b} - \hat{\theta}_n$ и строим эмпирическую функцию распределения \[\hat{H}(r) = \frac{1}{B} \sum_{b=1}^B I\left( \hat{R}^*_{n,b} \leq r \right) \]




%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Центральный интервал}
%----------------------------------------------------------

Границы интервала:

 \[ \hat{a} = \hat{\theta}_n - \hat{H}^{-1}\left(1 - \frac{\alpha}{2}\right) = 2 \hat{\theta}_n - \hat{\theta}^*_{1 - \frac{\alpha}{2}}, \] \[b = \hat{\theta}_n - \hat{H}^{-1}\left(\frac{\alpha}{2}\right) =  2 \hat{\theta}_n - \hat{\theta}^*_{\frac{\alpha}{2}}.\]
 
 \vspace{5mm}
 
 \pause
 
 
В итоге --- {\color{blue} центральный доверительный интервал} суть  \[\left( 2 \hat{\theta}_n - \hat{\theta}^*_{1 - \frac{\alpha}{2}}, \quad 2 \hat{\theta}_n - \hat{\theta}^*_{\frac{\alpha}{2}} \right). \]

\vspace{5mm}

Это \textit{асимптотический $1-\alpha$ доверительный интервал}.



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Интервал на основе процентилей}
%----------------------------------------------------------


\begin{enumerate}

\setcounter{enumi}{1}

\item \textbf{Интервал на основе процентилей}. 

\[\left(\hat{\theta}^*_{\frac{\alpha}{2}}, \quad \hat{\theta}^*_{1 - \frac{\alpha}{2}}\right). \]


\end{enumerate}

\vspace{5mm} 

Почему это доверительный интервал?


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Интервал на основе процентилей}
%----------------------------------------------------------

Пусть {\color{red} существует} монотонное преобразование $U = m(T)$, что $U \sim \mathcal{N}(\phi, c^2)$. 

\vspace{5mm}

Монотонное преобразование сохраняет квантили, поэтому $m(\theta^*_{\alpha/2}) = u^*_{\alpha/2}$ --- соотв. квантиль нормального распределения $ \mathcal{N}(\phi, c^2)$, т.е. $\phi - z_{\alpha/2} \, c$.	

\vspace{5mm}

\textbf{Доказательство, что доверительный интервал:}

\pause

\begin{figure}[h!]
\center{\includegraphics[width=0.8\textwidth]{pic/Proof2}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Интервал на основе процентилей}
%----------------------------------------------------------


Нам не нужно {\color{red} знать} монотонное преобразование $U = m(T)$, достаточно его существования. 

\vspace{5mm}

Более того, на практике достаточно {\color{red} существования} его аппроксимации.



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Литература}
%----------------------------------------------------------

На практике описанные выше интервалы могут быть близки.

\vspace{5mm}

Более точные обобщения этих бутстрепных интервалов описаны в 

\vspace{5mm}

\begin{thebibliography}{10}

    
  \beamertemplatebookbibitems
  \bibitem{Wasserman} Wasserman L. 
  
  \newblock{\em All of Nonparametric Statistics}.
    

\end{thebibliography}
  
  

%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------


%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Доверительные интервалы}
%----------------------------------------------------------

Итак, 3 способа построить \textit{доверительные интервалы}:


\vspace{5mm}

\begin{enumerate}

\item \textbf{Нормальный интервал} \[\left(\hat{\theta}_n + z_{\alpha/2} \, \hat{\operatorname{se}}_{\operatorname{boot}}, \quad \hat{\theta}_n - z_{\alpha/2} \, \hat{\operatorname{se}}_{\operatorname{boot}}\right)\] где  $\hat{\operatorname{se}}_{\operatorname{boot}} = \sqrt{v_{\operatorname{boot}}}$. 

\vspace{5mm}

\item \textbf{Центральный интервал} \[\left( 2 \hat{\theta}_n - \hat{\theta}^*_{1 - \frac{\alpha}{2}}, \quad 2 \hat{\theta}_n - \hat{\theta}^*_{\frac{\alpha}{2}} \right). \]

\vspace{5mm}


\item \textbf{Интервал на основе процентилей} \[\left(\hat{\theta}^*_{\frac{\alpha}{2}}, \quad \hat{\theta}^*_{1 - \frac{\alpha}{2}}\right). \]

\end{enumerate}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------




\section{Self-Supervision}



\begin{frame}[plain]\frametitle{Self-Supervision} \tableofcontents[currentsection]\end{frame}



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Self-supervision}
%----------------------------------------------------------


\begin{figure}[h!]
\center{\includegraphics[width=0.5\textwidth]{pic/SelfSuper}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}




%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Self-supervision}
%----------------------------------------------------------

\begin{center}
\Large {\color{blue} Самообучение} в ML (Self-supervision) идейно похоже на бутстреп.

\vspace{5mm} 

Пусть у нас даны неразмеченные данные (картинки).

\vspace{5mm} 

Откуда взять информацию для их классификации?
\end{center}



\begin{figure}[h!]
\center{\includegraphics[width=0.75\textwidth]{pic/UnSuper}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Аугментация}
%----------------------------------------------------------


\begin{center}
\large Стандартная техника в DL для расширения датасета --- {\color{blue} аугментация} данных.

\vspace{5mm} 

Картинки можно поворачивать, увеличивать, отражать, менять цвета и т.д.
\end{center}



\begin{figure}[h!]
\center{\includegraphics[width=0.75\textwidth]{pic/Aug}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Что спросить нейронку?}
%----------------------------------------------------------

\begin{center}
Итак, мы не знаем --- котик или пёсик, но теперь у нас куча картинок с ним. 

\vspace{5mm}

\textbf{Q:} Догадываетесь, что можно заставить выучить нейронку?

\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.75\textwidth]{pic/CatBoost0}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Идея самообучения}
%----------------------------------------------------------

\begin{center}
Как заставить нейронку понять, что такое кошка?

\vspace{5mm}

То есть --- как построить функцию, принимающую одно значение на всех кошках?

\vspace{5mm}

{\color{blue} \textbf{Ключевая идея!}} Можно спросить --- \textit{являются ли две аугментации производными одной и той же картинки?}
\end{center}




\begin{figure}[h!]
\center{\includegraphics[width=0.75\textwidth]{pic/CatBoost}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Эквивариантность}
%----------------------------------------------------------


\begin{itemize}
\item \large По сути мы строим {\color{blue}инвариантные\footnote{в смысле одинаковые на классах эквивалентности} отображения}. 

\vspace{5mm}

\item Если отображение $F$ т.,ч. \[ F(\text{хвост кошки}) = F(\text{ухо кошки}) = F(\text{лапы кошки}),\] то отображение $F$ зависит от общего, т.е. от ``кошки''.  
\end{itemize}



%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

%----------------------------------------------------------
\begin{frame}[plain]\frametitle{Философский взгляд на вещи}
%----------------------------------------------------------

\begin{center}
\large ``Вся европейская философия на самом деле - ряд примечаний к Платону''.  $\smiley{}$
\end{center}

\vspace{-2mm}

\begin{figure}[h!]
\center{\includegraphics[width=0.77\textwidth]{pic/Plato}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}
%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------



%----------------------------------------------------------
\begin{frame}[plain]\frametitle{BYOL}
%----------------------------------------------------------


\begin{center}

Естественно, в ML и Self-Supervision полно разных идей. 

\vspace{5mm}


Одна из известных статей про Self-supervision называется 

\vspace{5mm}

\hyperlink{https://arxiv.org/pdf/2006.07733.pdf}{Bootstrap your own latent: A new approach to self-supervised Learning}

\end{center}


\begin{figure}[h!]
\center{\includegraphics[width=0.77\textwidth]{pic/BYOL}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}


%----------------------------------------------------------
\end{frame}
%----------------------------------------------------------
%----------------------------------------------------------
\begin{frame}[plain]\frametitle{To be continued}
%----------------------------------------------------------

\begin{center}
\large Неужели сэмплировать числа  --- предел наших генеративных способностей?

\vspace{5mm}

Обсудим генеративные модели {\color{red} на 12 лекции}. 

\end{center}

\begin{figure}[h!]
\center{\includegraphics[width=0.8\textwidth]{pic/GAN}}
%\caption{Разделы статистики, которые мы обсудили} \label{Fig:}
\end{figure}

  
  %----------------------------------------------------------
\end{frame}
%----------------------------------------------------------

\end{document}